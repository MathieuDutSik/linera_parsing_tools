[
    {
        "name": "Removing initial directory if existing",
        "directory": "/tmp/",
        "command": "rm -rf TEST_MIGRATION"
    },
    {
        "name": "Creating initial directory",
        "directory": "/tmp/",
        "command": "mkdir -p TEST_MIGRATION/WORK"
    },
    {
        "name": "Cloning the before migration stuff",
        "directory": "/tmp/TEST_MIGRATION/",
        "command": "git clone https://github.com/MathieuDutSik/linera-protocol_second linera-protocol_old_schema"
    },
    {
        "name": "Shifting to commit before schema switch",
        "directory": "/tmp/TEST_MIGRATION/linera-protocol_old_schema",
        "command": "git checkout df074a1016f6b98d925b04f51165d51ee97b728e"
    },
    {
        "name": "Compiling the old code (with ScyllaDb)",
        "directory": "/tmp/TEST_MIGRATION/linera-protocol_old_schema",
        "command": "cargo build --features scylladb"
    },
    {
        "name": "Eliminating old storage",
        "directory": "/tmp/TEST_MIGRATION/linera-protocol_old_schema",
        "command": "./target/debug/linera storage delete-all --storage scylladb:tcp:localhost:9042:table_a"
    },
    {
        "name": "Cloning the after migration stuff",
        "directory": "/tmp/TEST_MIGRATION/",
        "command": "git clone https://github.com/MathieuDutSik/linera-protocol_second linera-protocol_new_schema"
    },
    {
        "name": "Shifting to the migration branch",
        "directory": "/tmp/TEST_MIGRATION/linera-protocol_new_schema",
        "command": "git checkout migration_database_schema"
    },
    {
        "name": "Compiling the migration branch (with ScyllaDb)",
        "directory": "/tmp/TEST_MIGRATION/linera-protocol_new_schema",
        "command": "cargo build --features scylladb"
    },
    {
        "name": "Spanning the validators on the old schema",
        "directory": "/tmp/TEST_MIGRATION/linera-protocol_old_schema",
        "command": "./target/debug/linera net up --policy-config testnet --storage service:tcp:localhost:1235:table_a --path /tmp/TEST_MIGRATION/WORK &",
        "stdout": "Linera_old_schema_net_up_out",
        "stderr": "Linera_old_schema_net_up_err"
    },
    {
        "name": "Running the faucet on the old schema",
        "directory": "/tmp/TEST_MIGRATION/linera-protocol_old_schema",
        "command": "./target/debug/linera net up --policy-config testnet --storage service:tcp:localhost:1235:table_a --path /tmp/TEST_MIGRATION/WORK &",
        "environments": ["export LINERA_WALLET=/tmp/TEST_MIGRATION/WORK/wallet_0.json",
                         "export LINERA_KEYSTORE=/tmp/TEST_MIGRATION/WORK/keystore_0.json",
                         "export LINERA_STORAGE=rocksdb:/tmp/TEST_MIGRATION/WORK/client_0.db"],
        "stdout": "Linera_old_schema_faucet_out",
        "stderr": "Linera_old_schema_faucet_err"
    },
    {
        "name": "Running the faucet on the old schema",
        "directory": "/tmp/TEST_MIGRATION/linera-protocol_old_schema",
        "command": "./target/debug/linera net up --policy-config testnet --storage service:tcp:localhost:1235:table_a --path /tmp/TEST_MIGRATION/WORK &",
        "environments": ["export LINERA_WALLET=/tmp/TEST_MIGRATION/WORK/wallet_0.json",
                         "export LINERA_KEYSTORE=/tmp/TEST_MIGRATION/WORK/keystore_0.json",
                         "export LINERA_STORAGE=rocksdb:/tmp/TEST_MIGRATION/WORK/client_0.db"],
        "stdout": "Linera_old_schema_faucet_out",
        "stderr": "Linera_old_schema_faucet_err"
    }
]
